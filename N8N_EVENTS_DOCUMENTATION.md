# N8N Webhook –°–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —á–∞—Ç–æ–≤

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è webhook'–∞ n8n, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —á–∞—Ç–æ–≤ –º–µ–∂–¥—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏ PostgreSQL —á–µ—Ä–µ–∑ n8n.

**Webhook URL:** `https://n8n.24superego.ru/webhook/authorization`

## –°–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üì• users_fetch - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "users_fetch",
  "email": "user@example.com"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": true,
  "data": [
    {
      "id": "telegram_12345",
      "subscriberId": "telegram_12345",
      "firstName": "–ò–≤–∞–Ω",
      "lastName": "–ò–≤–∞–Ω–æ–≤",
      "username": "ivan_ivanov",
      "email": "ivan@example.com",
      "phone": "+79123456789",
      "photoUrl": "",
      "registrationDate": "17.07.2025",
      "lastActivity": "–û–Ω–ª–∞–π–Ω",
      "tags": ["VIP", "–∞–∫—Ç–∏–≤–Ω—ã–π"],
      "source": "–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª",
      "subscriberPlatformId": "telegram_12345",
      "referalId": "ref_123",
      "variables": [
        {"key": "city", "value": "–ú–æ—Å–∫–≤–∞"},
        {"key": "age", "value": "25"}
      ],
      "purchases": [
        {
          "id": "purchase_1",
          "productName": "–ö—É—Ä—Å –ø—Ä–æ–¥–∞–∂",
          "amount": 5000,
          "date": "2025-07-15",
          "status": "active"
        }
      ]
    }
  ]
}
```

### ‚ûï user_create - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_create",
  "email": "user@example.com",
  "user": {
    "id": "telegram_12345",
    "subscriberId": "telegram_12345",
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ò–≤–∞–Ω–æ–≤",
    "username": "ivan_ivanov",
    "source": "–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª",
    "registrationDate": "17.07.2025",
    "variables": [],
    "purchases": []
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": true,
  "data": {
    "user": {
      "id": "telegram_12345",
      // ... –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }
  }
}
```

### ‚úèÔ∏è user_update - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_update",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "updates": {
    "firstName": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á",
    "tags": ["VIP", "–ø—Ä–µ–º–∏—É–º"],
    "lastActivity": "–û–Ω–ª–∞–π–Ω"
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": true,
  "data": {
    "id": "telegram_12345",
    // ... –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  }
}
```

### üóëÔ∏è user_delete - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–£–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_delete",
  "email": "user@example.com",
  "userId": "telegram_12345"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": true
}
```

## –°–æ–±—ã—Ç–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚ûï user_variable_add - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_variable_add",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "key": "city",
  "value": "–ú–æ—Å–∫–≤–∞"
}
```

### ‚úèÔ∏è user_variable_update - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_variable_update",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "key": "city",
  "value": "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥"
}
```

### üóëÔ∏è user_variable_delete - –£–¥–∞–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_variable_delete",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "key": "city"
}
```

## –°–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üõí user_purchase_add - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_purchase_add",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "purchase": {
    "id": "purchase_1",
    "productName": "–ö—É—Ä—Å –ø—Ä–æ–¥–∞–∂",
    "amount": 5000,
    "date": "2025-07-15",
    "status": "active",
    "endDate": "2025-08-15"
  }
}
```

### ‚úèÔ∏è user_purchase_update - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_purchase_update",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "purchaseId": "purchase_1",
  "updates": {
    "status": "completed",
    "endDate": "2025-07-30"
  }
}
```

### üóëÔ∏è user_purchase_delete - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "user_purchase_delete",
  "email": "user@example.com",
  "userId": "telegram_12345",
  "purchaseId": "purchase_1"
}
```

## –°–æ–±—ã—Ç–∏—è –¥–ª—è —á–∞—Ç–æ–≤

### üìã chat_list_fetch - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ (–ë–ï–ó —Å–æ–æ–±—â–µ–Ω–∏–π)

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "chat_list_fetch",
  "email": "user@example.com"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": true,
  "data": [
    {
      "chatId": "telegram_12345",
      "lastMessage": {
        "content": "–ü—Ä–∏–≤–µ—Ç!",
        "timestamp": "2025-07-17T10:30:00Z",
        "type": "client"
      },
      "unreadCount": 2,
      "lastActivity": "2025-07-17T10:30:00Z"
    },
    {
      "chatId": "telegram_67890",
      "lastMessage": {
        "content": "–°–ø–∞—Å–∏–±–æ!",
        "timestamp": "2025-07-17T09:15:00Z",
        "type": "manager"
      },
      "unreadCount": 0,
      "lastActivity": "2025-07-17T09:15:00Z"
    }
  ]
}
```

### üìÑ chat_messages_fetch - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "chat_messages_fetch",
  "email": "user@example.com",
  "chatId": "telegram_12345",
  "page": 0,
  "limit": 50,
  "before": 1705425000000  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": true,
  "data": {
    "messages": [
      {
        "id": "msg_1",
        "senderId": "telegram_12345",
        "senderName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "content": "–ü—Ä–∏–≤–µ—Ç!",
        "timestamp": "2025-07-17T10:30:00Z",
        "type": "client",
        "isOwnMessage": false
      },
      {
        "id": "msg_2",
        "senderId": "manager_1",
        "senderName": "–ú–µ–Ω–µ–¥–∂–µ—Ä",
        "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!",
        "timestamp": "2025-07-17T10:31:00Z",
        "type": "manager",
        "isOwnMessage": true
      }
    ],
    "pagination": {
      "page": 0,
      "limit": 50,
      "total": 1250,
      "hasMore": true
    }
  }
}
```

### üíæ chat_save - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–∞

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "chat_save",
  "email": "user@example.com",
  "chat": {
    "chatId": "telegram_12345",
    "messages": [
      {
        "id": "msg_1",
        "senderId": "telegram_12345",
        "senderName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "content": "–ü—Ä–∏–≤–µ—Ç!",
        "timestamp": "2025-07-17T10:30:00Z",
        "type": "client",
        "isOwnMessage": false
      }
    ]
  }
}
```

### üóëÔ∏è chat_delete - –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "chat_delete",
  "email": "user@example.com",
  "chatId": "telegram_12345"
}
```

### üí¨ message_add - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "message_add",
  "email": "user@example.com",
  "chatId": "telegram_12345",
  "message": {
    "id": "msg_2",
    "senderId": "manager_1",
    "senderName": "–ú–µ–Ω–µ–¥–∂–µ—Ä",
    "content": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
    "timestamp": "2025-07-17T10:31:00Z",
    "type": "manager",
    "isOwnMessage": true
  }
}
```

### üì¶ chats_batch_save - –ü–∞–∫–µ—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "event": "chats_batch_save",
  "email": "user@example.com",
  "chats": {
    "telegram_12345": {
      "chatId": "telegram_12345",
      "messages": [...]
    },
    "telegram_67890": {
      "chatId": "telegram_67890", 
      "messages": [...]
    }
  }
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—à–∏–±–æ–∫:

**–û—à–∏–±–∫–∞:**
```json
{
  "status": false,
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```javascript
// –£—Å–ø–µ—à–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
logger.logAPICall('users', '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', request, response, duration);

// –û—à–∏–±–∫–∞
logger.error('users', '–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏', error);
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç n8n**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ n8n
2. **Fallback –Ω–∞ IndexedDB**: –ü—Ä–∏ –æ—à–∏–±–∫–µ n8n –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**: –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ n8n
4. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: IndexedDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à
5. **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å IndexedDB
- ‚úÖ **Offline —Ä–µ–∂–∏–º**: –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**: n8n —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram –±–æ—Ç–∞

```javascript
// 1. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ chat-server
// 2. ChatsSection —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const newUser = {
  id: 'telegram_12345',
  firstName: '–ò–≤–∞–Ω',
  source: '–û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–Ω–∞–ª'
  // ...
};

// 3. addUsersFromCSV –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å n8n
await addUsersFromCSV([newUser]);
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å n8n
await addUserVariable('telegram_12345', 'city', '–ú–æ—Å–∫–≤–∞');
await updateUserVariable('telegram_12345', 'city', '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥');
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∞–º–∏

```javascript
const purchase = {
  id: 'purchase_1',
  productName: '–ö—É—Ä—Å –ø—Ä–æ–¥–∞–∂',
  amount: 5000,
  status: 'active'
};

await addUserPurchase('telegram_12345', purchase);
```